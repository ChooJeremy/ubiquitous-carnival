<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Drawer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .discard-pile-card {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">Card Drawer</h1>
            <p class="text-lg text-gray-600 mt-2">Draw cards from different tiers or by specific ID.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Controls -->
            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                <div class="mb-6">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Draw from a Tier</h2>
                    <div id="tier-buttons" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-3">
                        <!-- Tier buttons will be inserted here -->
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Draw by ID</h2>
                    <div class="flex space-x-2">
                        <input type="text" id="card-id-input" placeholder="e.g., T1-01" class="flex-grow w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button id="draw-by-id-btn" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors duration-300">
                            Draw
                        </button>
                    </div>
                </div>
                 <div class="mt-6 text-center">
                    <button id="reset-btn" class="w-full px-6 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-300">
                        Reset Game
                    </button>
                </div>
            </div>

            <!-- Middle Column: Current Card -->
            <div class="lg:col-span-1">
                 <h2 class="text-2xl font-semibold mb-4 text-center">Current Card</h2>
                <div id="current-card-display" class="bg-white p-6 rounded-lg card min-h-[300px] flex items-center justify-center">
                   <p class="text-gray-500 text-lg">No card drawn yet.</p>
                </div>
            </div>

            <!-- Right Column: Discard Pile -->
            <div class="lg:col-span-1">
                <h2 class="text-2xl font-semibold mb-4 text-center">Discard Pile</h2>
                <div id="discard-pile" class="bg-white p-4 rounded-lg shadow-md min-h-[300px] max-h-[60vh] overflow-y-auto">
                    <p id="discard-placeholder" class="text-gray-500 text-center mt-4">Discarded cards will appear here.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const icons = {
            "Daily use": `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>`,
            "Concepts": `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 100 2h.01a1 1 0 100-2H11zM12 2.252A8.014 8.014 0 0116.473 6H17a1 1 0 100-2h-1.332a1 1 0 00-.953.666 6.002 6.002 0 00-1.912-1.396A1 1 0 0012 2.252zM4.773 6.002A8.014 8.014 0 019 2.252a1 1 0 00-1.047-.953A6.002 6.002 0 006.62 4.666 1 1 0 006.332 6H7a1 1 0 100-2h-.527a8.014 8.014 0 01-1.699-1.998zM11 18.252a1 1 0 001.047.953A6.002 6.002 0 0013.38 15.334a1 1 0 00.288-1.334l-1.38-2.396a1 1 0 00-1.732 1l1.38 2.396a4.002 4.002 0 01-2.91 1.252 1 1 0 00-1.047.953zM8.227 14.002L6.847 11.606a1 1 0 00-1.732-1l-1.38 2.396a1 1 0 00.288 1.334 6.002 6.002 0 002.334 1.912 1 1 0 001.047-.953 4.002 4.002 0 01-1.18-3.348z" /></svg>`,
            "Military": `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 4a1 1 0 000 2 1 1 0 011 1v1H7a1 1 0 000 2h1v1a1 1 0 01-1 1 1 1 0 000 2h1v3a1 1 0 002 0v-3h2v3a1 1 0 002 0v-3h1a1 1 0 100-2 1 1 0 01-1-1V9h1a1 1 0 100-2h-1V6a1 1 0 011-1 1 1 0 100-2h-1a1 1 0 00-1 1v1H9V5a1 1 0 00-1-1H7z" clip-rule="evenodd" /></svg>`,
            "Science": `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 4.4A1 1 0 0116 14h-2.25l-2.5-4.333L8.75 14H6.5a1 1 0 01-.8-1.6L8.25 8 5.7 3.6A1 1 0 015 2H3a1 1 0 00-1 1v1zM4 4h1v1H4V4zm11.5 6L13 8h-1.5l-2.5 4.333L6.5 8H5l2.5 4.4.05.083L8.75 14h.5l2.5-4.333L14.25 8h.25l.05.083L17 12.4V12h-1.5z" clip-rule="evenodd" /></svg>`,
            "Wonder": `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 text-purple-500" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`,
        };

        let allCards = {};
        let availableCards = {};
        let drawnCards = new Set();
        let currentCard = null;
        let discardPile = [];

        async function loadCards() {
            try {
                const response = await fetch('cards.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allCards = await response.json();
                // Deep copy allCards to availableCards for the game session
                availableCards = JSON.parse(JSON.stringify(allCards));
            } catch (error) {
                console.error("Could not load card data:", error);
                const display = document.getElementById('current-card-display');
                display.innerHTML = `<p class="text-red-500 font-semibold">Error: Could not load card data from cards.json. Please ensure the file exists and is in the same directory.</p>`;
                const tierButtons = document.getElementById('tier-buttons');
                tierButtons.innerHTML = `<p class="text-red-500 text-sm col-span-full">Card loading failed.</p>`;
            }
        }

        function setupTierButtons() {
            const container = document.getElementById('tier-buttons');
            container.innerHTML = '';
            if (Object.keys(allCards).length === 0) return; // Don't setup if loading failed
            Object.keys(allCards).forEach(tierKey => {
                const tierNum = tierKey.slice(1);
                const button = document.createElement('button');
                button.textContent = `Tier ${tierNum}`;
                button.dataset.tier = tierKey;
                button.className = 'px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-300';
                button.addEventListener('click', () => drawFromTier(tierKey));
                container.appendChild(button);
            });
        }
        
        function updateTierButtons() {
            const buttons = document.querySelectorAll('#tier-buttons button');
            buttons.forEach(button => {
                const tierKey = button.dataset.tier;
                if (availableCards[tierKey] && availableCards[tierKey].length === 0) {
                    button.disabled = true;
                } else {
                    button.disabled = false;
                }
            });
        }

        function drawFromTier(tierKey) {
            if (availableCards[tierKey] && availableCards[tierKey].length > 0) {
                const randomIndex = Math.floor(Math.random() * availableCards[tierKey].length);
                const card = availableCards[tierKey][randomIndex];
                drawCard(card);
            } else {
                alert(`No more cards available in Tier ${tierKey.slice(1)}.`);
            }
        }
        
        function drawCardById(cardId) {
            let foundCard = null;
            for (const tierKey in allCards) {
                foundCard = allCards[tierKey].find(c => c.id === cardId);
                if(foundCard) break;
            }

            if(!foundCard){
                 alert('Card ID not found.');
                 return;
            }
            
            if(drawnCards.has(cardId)){
                alert('This card has already been drawn.');
                return;
            }
            
            drawCard(foundCard);
        }

        function drawCard(card) {
            if (drawnCards.has(card.id)) return;

            // Move previous card to discard
            if (currentCard) {
                discardPile.unshift(currentCard);
                updateDiscardPile();
            }

            // Set new card as current
            currentCard = card;
            displayCard(currentCard);

            // Update state
            drawnCards.add(card.id);
            const tierKey = card.id.split('-')[0];
            availableCards[tierKey] = availableCards[tierKey].filter(c => c.id !== card.id);
            
            updateTierButtons();
        }

        function displayCard(card) {
            const display = document.getElementById('current-card-display');
            if (!card) {
                display.innerHTML = `<p class="text-gray-500 text-lg">No card drawn yet.</p>`;
                return;
            }

            const rowsHtml = card.rows.map(row => {
                const iconsHtml = row.icons.map(iconName => icons[iconName] || '').join('');
                return `
                <li class="flex items-center text-lg py-1">
                    ${iconsHtml}
                    <span class="font-medium">${row.text}</span>
                </li>
            `}).join('');

            display.innerHTML = `
                <div class="w-full">
                    <div class="flex justify-between items-center border-b-2 border-gray-200 pb-2 mb-4">
                        <h3 class="text-2xl font-bold text-indigo-700">${card.id}</h3>
                        <span class="text-sm font-semibold bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full">Tier ${card.tier}</span>
                    </div>
                    <ul class="space-y-2">
                        ${rowsHtml}
                    </ul>
                </div>
            `;
        }
        
        function updateDiscardPile() {
            const pileDiv = document.getElementById('discard-pile');
            const placeholder = document.getElementById('discard-placeholder');
            
            if(discardPile.length === 0){
                pileDiv.innerHTML = '';
                pileDiv.appendChild(placeholder);
                placeholder.style.display = 'block';
            } else {
                 // placeholder.style.display = 'none';
                 pileDiv.innerHTML = '';
                 discardPile.forEach(card => {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'discard-pile-card bg-gray-50 p-2 rounded-md mb-2 flex justify-between items-center border border-gray-200';
                    cardEl.innerHTML = `
                        <span class="font-semibold text-gray-700">${card.id}</span>
                        <span class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full">Tier ${card.tier}</span>
                    `;
                    pileDiv.appendChild(cardEl);
                });
            }
        }
        
        function resetGame() {
            location.reload();
            // drawnCards.clear();
            // currentCard = null;
            // discardPile = [];
            
            // // Deep copy allCards to availableCards
            // availableCards = JSON.parse(JSON.stringify(allCards));

            // displayCard(null);
            // updateDiscardPile();
            // updateTierButtons();
            
            // document.getElementById('card-id-input').value = '';
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', async () => {
            await loadCards(); // Wait for cards to load from JSON
            
            // Setup UI based on loaded data
            setupTierButtons();
            updateTierButtons();

            document.getElementById('draw-by-id-btn').addEventListener('click', () => {
                const input = document.getElementById('card-id-input');
                const cardId = input.value.trim().toUpperCase();
                if (cardId) {
                    drawCardById(cardId);
                    input.value = '';
                }
            });
            
            document.getElementById('card-id-input').addEventListener('keypress', function(e) {
                if(e.key === 'Enter') {
                    document.getElementById('draw-by-id-btn').click();
                }
            });
            
            document.getElementById('reset-btn').addEventListener('click', resetGame);
        });

    </script>

</body>
</html>

